<!DOCTYPE html>
<title>Code</title>
<link rel="stylesheet" href="/css/main.css">

<style type="text/css" media="screen">
  #editor { 
    position: absolute;
    top: 40px;
    right: 0;
    bottom: 0;
    left: 0;
  }

  #save-button, #video-button {
  	float: right;
  }
</style>
<header>
	<img src="#" alt="logo">
	<i>Code In The Dark</i>
	<button id="save-button">Save</button>
	<button id="video-button">Video</button>
</header>
<div id="editor"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.7/socket.io.min.js"></script>
<script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.2/ace.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.2/mode-html.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.2/theme-monokai.js"></script>
<script>
(function () {
  var editor = ace.edit("editor");
  var socket = io();
  var old_data;
  editor.setTheme("ace/theme/monokai");
  editor.getSession().setMode("ace/mode/html");
  editor.setHighlightActiveLine(true);

  editor.commands.addCommand({
    name: 'save',
    bindKey: {win: 'Ctrl-S',  mac: 'Command-S'},
    exec: function(editor) {
      store();
    },
    readOnly: false
  });
  
  socket.on('success', function() {
    //TO DO: create flash message to user
  });
  $('#save-button').click(store);

  function store(data) {
    var data = {
      'user_id' : '', // user id
      'data' : editor.getValue()
    };    
    if(JSON.stringify(old_data) !== JSON.stringify(data)) {
      socket.emit('store', data);
      old_data = data;
    }
  }

})();
</script>
