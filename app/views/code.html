<!DOCTYPE html>
<title>Code</title>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" integrity="sha512-dTfge/zgoMYpP7QbHy4gWMEGsbsdZeCXz7irItjcC3sPUFtf0kuFbDz/ixG7ArTxmDjLXDmezHubeNikyKGVyQ==" crossorigin="anonymous">
<link rel="stylesheet" href="../static/css/main.css">
<style type="text/css" media="screen">
  #editor { 
    position: absolute;
    top: 50px;
    right: 0;
    bottom: 0;
    left: 0;
  }

  .btn {
    margin: 8px 0;
  }
</style>

<nav class="navbar navbar-inverse">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-2">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="#">Code In The Dark</a>
    </div>

    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-2">
      <ul class="nav navbar-nav navbar-right">
        <li><a href="#!" data-toggle="modal" data-target="#video-modal">Video</a></li>
        <li><button id="save-button" class="btn btn-danger btn-sm" href="#!">Save</button></li>
      </ul>
    </div>
  </div>
</nav>


<div id="editor"></div>


  <!-- Modal -->
<div class="modal fade" id="video-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Video Preview
      <div class="modal-body">
        <iframe width="100%" height="315" src="https://www.youtube.com/embed/y-yzL5zJVno" frameborder="0" allowfullscreen></iframe>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.7/socket.io.min.js"></script>
<script src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.2/ace.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.2/mode-html.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.2/theme-monokai.js"></script>
<script>
(function () {
  var editor = ace.edit("editor");
  var socket = io();
  var old_data;
  editor.setTheme("ace/theme/monokai");
  editor.getSession().setMode("ace/mode/html");
  editor.setHighlightActiveLine(true);
  editor.getSession().setUseWorker(false);
  editor.setBehavioursEnabled(false);
  editor.commands.addCommand({
    name: 'save',
    bindKey: {win: 'Ctrl-S',  mac: 'Command-S'},
    exec: function(editor) {
      store();
    },
    readOnly: false
  });
  
  socket.on('success', function() {
    //TO DO: create flash message to user
  });
  $('#save-button').click(store);

  function store(data) {
    var data = {
      'user_id' : '', // user id
      'data' : editor.getValue()
    };    
    if(JSON.stringify(old_data) !== JSON.stringify(data)) {
      socket.emit('store', data);
      old_data = data;
    }
  }

})();
</script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js" integrity="sha512-K1qjQ+NcF2TYO/eI3M6v8EiNYZfA95pQumfvcVrTHtwQVDG+aHRqLi/ETn2uB+1JqwYqVG3LIvdm9lj6imS/pQ==" crossorigin="anonymous"></script>